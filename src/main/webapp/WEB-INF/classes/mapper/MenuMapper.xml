<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.smm.payCenter.dao.MenuDao" >
  <resultMap id="BaseResultMap" type="com.smm.payCenter.domain.Menu" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 16 09:54:18 CST 2015.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="menu_name" property="menuName" jdbcType="VARCHAR" />
    <result column="level" property="level" jdbcType="INTEGER" />
    <result column="order" property="order" jdbcType="INTEGER" />
    <result column="menu_url" property="menuUrl" jdbcType="VARCHAR" />
    <result column="parent_Id" property="parentId" jdbcType="INTEGER" />
    <result column="css_class" property="cssClass" jdbcType="VARCHAR" />
  </resultMap>
  <!-- 父級菜單 -->
  <select id="queryParentMenu"  parameterType="java.util.Map" resultMap="BaseResultMap">
  
  	SELECT * FROM fnl_menu a   

	INNER JOIN fnl_role_relation b  on a.id = b.menu_id 
	
	WHERE b.role_id = #{roleId} and a.level = 1
	
  </select>
  
  <!-- 子菜單  -->
  <select id="queryChildMenu"  parameterType="java.util.Map" resultMap="BaseResultMap">
  	
  	SELECT * FROM fnl_menu a  

	INNER JOIN  fnl_role_relation b ON a.id = b.menu_id
	
	WHERE  a.parent_Id = #{parentId} and b.role_id = #{roleId}  

  </select>
  
  <!-- 树形权限菜单 -->
  <select id="getTreeNode" parameterType="java.util.Map" resultType="com.smm.payCenter.domain.TreeNodeVO">
  	<!-- 
  	SELECT id AS id,parent_Id AS pId, menu_name AS name 
		
	FROM fnl_menu -->
	
	SELECT a.id AS id,a.parent_Id AS pId, a.menu_name AS name 

		
	FROM fnl_menu a
	
	<if test=" roleId != null">
	
		INNER JOIN fnl_role_relation b ON a.id = b.menu_id
	
		WHERE b.role_id = #{roleId}
		
	</if>
		
  </select>
  
  <insert id="addRoleRelation" parameterType="java.util.Map">
  	
  	insert into fnl_role_relation (menu_id, role_id)
  	
    values (#{menuId,jdbcType=INTEGER}, #{roleId,jdbcType=INTEGER})
    
  </insert>
</mapper>