<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.smm.payCenter.dao.MoneyExceptionDao" >
  <resultMap id="BaseResultMap" type="com.smm.payCenter.domain.MoneyException" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Nov 20 09:14:59 CST 2015.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="create_time" property="createTime" jdbcType="VARCHAR" />
    <result column="user_id" property="userId" jdbcType="INTEGER" />
    <result column="user_company_name" property="userCompanyName" jdbcType="VARCHAR" />
    <result column="operate" property="operate" jdbcType="INTEGER" />
    <result column="payment_id" property="paymentId" jdbcType="INTEGER" />
    <result column="pay_channel_id" property="payChannelId" jdbcType="INTEGER" />
    <result column="user_pay_channel_account" property="userPayChannelAccount" jdbcType="VARCHAR" />
    <result column="user_pay_channel_money" property="userPayChannelMoney" jdbcType="DECIMAL" />
    <result column="user_money" property="userMoney" jdbcType="DECIMAL" />
    <result column="audit_user_id" property="auditUserId" jdbcType="INTEGER" />
    <result column="audit_time" property="auditTime" jdbcType="VARCHAR" />
    <result column="audit_status" property="auditStatus" jdbcType="INTEGER" />
    <result column="payment_no" property="paymentNo" jdbcType="VARCHAR" />
  </resultMap>
  <!-- 交易记录异常信息 -->
  <select id="queryMoneyExceptionList" parameterType="java.util.Map" resultMap="BaseResultMap">
  	
  	SELECT a.*,b.deal_money as dealMoney,b.payment_no AS paymentNo ,c.user_name as userAccountNo  FROM user_money_exception a

	LEFT JOIN tr_payment_record b ON b.payment_id = a.payment_id
	
	INNER JOIN user_account c ON c.user_id = a.user_id
	
	where 1 = 1
  	
  	<if test=" startTime != null and startTime !='' ">
  		and a.create_time &gt;= #{startTime}
  	</if>
  	
  	<if test="endTime != null and endTime !=''">
  		and a.create_time &lt;= #{endTime}
  	</if>
  	
  	ORDER BY a.create_time DESC
	
	<!-- 分页 -->
	<if test="startNum!=null and endNum !=null ">
		limit ${startNum},${endNum}
	</if>
  	
  </select>
  
  <!-- 交易记录异常信息条数 -->
  <select id="queryMoneyExceptionCount" parameterType="java.util.Map" resultType="Integer">
  	SELECT COUNT(1) FROM
  	(
	  	SELECT a.*,b.deal_money as dealMoney ,c.user_name as userAccountNo  FROM user_money_exception a

		LEFT JOIN tr_payment_record b ON b.payment_id = a.payment_id
		
		INNER JOIN user_account c ON c.user_id = a.user_id
		
		where 1 = 1
	  	
	  	<if test=" startTime != null and startTime !='' ">
	  		and a.create_time &gt;= #{startTime}
	  	</if>
	  	
	  	<if test="endTime != null and endTime !=''">
	  		and a.create_time &lt;= #{endTime}
	  	</if>
  	) temp
  
  </select>
  
  <update id="updateMoneyException" parameterType="java.util.Map">
  	UPDATE user_money_exception set audit_status = 1 , audit_time = #{auditTime}
  	
  	where id = #{moneyExceptionId}
  
  </update>
  
</mapper>